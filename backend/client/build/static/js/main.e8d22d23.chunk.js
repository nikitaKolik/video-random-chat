(this["webpackJsonpreact-redux-jwt-auth"]=this["webpackJsonpreact-redux-jwt-auth"]||[]).push([[0],{147:function(e,t,a){e.exports=a(222)},155:function(e,t,a){},157:function(e,t,a){},214:function(e,t){},222:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(19),c=a.n(s),o=a(29),i=a(48),l=a(127),u=a(128),p=a(28),d={isLoggedIn:!1,user:null},m={},f=Object(i.combineReducers)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"REGISTER_SUCCESS":case"REGISTER_FAIL":return Object(p.a)(Object(p.a)({},e),{},{isLoggedIn:!1});case"LOGIN_SUCCESS":return Object(p.a)(Object(p.a)({},e),{},{isLoggedIn:!0,user:n.user});case"LOGIN_FAIL":return Object(p.a)(Object(p.a)({},e),{},{isLoggedIn:!1,user:null});case"LOGOUT":return Object(p.a)(Object(p.a)({},e),{},{isLoggedIn:!1});case"UPDATE_USER":return Object(p.a)(Object(p.a)({},e),{},{isLoggedIn:!0,user:n.user});case"UPDATE_FAIL":return Object(p.a)(Object(p.a)({},e),{},{isLoggedIn:!1});default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"SET_MESSAGE":return{message:n};case"CLEAR_MESSAGE":return{message:""};default:return e}}}),g=[u.a],h=Object(i.createStore)(f,Object(l.composeWithDevTools)(i.applyMiddleware.apply(void 0,g))),v=(a(155),a(8)),b=a(10),E=a(12),y=a(11),x=a(269),w=(a(156),a(157),a(3)),k=a.n(w),O=a(7),j=a(59),C=a.n(j),S=a(60),N=a.n(S),I=a(27),M=a.n(I),T="https://arcane-retreat-64091.herokuapp.com/api/user",A=new function e(){Object(v.a)(this,e),this.login=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.a.post(T+"/login",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.logout=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.removeItem("user"),console.log("log out.."),t&&M.a.post(T+"/logout",{},{headers:{token:t.token}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.register=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.a.post(T,t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.authenticate=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.a.post(T+"/authenticate",{},{headers:{token:t}});case 2:if("true"!==e.sent.data.sucess){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getFriendInfo=function(){var e=Object(O.a)(k.a.mark((function e(t,a){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.a.post(T+"/getAUser",{id:t},{headers:{token:a}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.update=function(){var e=Object(O.a)(k.a.mark((function e(t,a){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.a.post(T+"/update",{user:t},{headers:{token:a}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.getAll=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.a.get(T+"/getAll",{headers:{token:t}});case 3:return a=e.sent,e.abrupt("return",a.data);case 7:return e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",{success:!1,error:"some errors occured in client side"});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},R=function(e){return function(){var t=Object(O.a)(k.a.mark((function t(a){var n;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A.register(e);case 2:if(!0!==(n=t.sent).success){t.next=10;break}return console.log(n),a({type:"REGISTER_SUCCESS"}),a({type:"SET_MESSAGE",payload:n.message}),t.abrupt("return",n);case 10:return a({type:"REGISTER_FAIL"}),a({type:"SET_MESSAGE",payload:n.message||n.error}),t.abrupt("return",n);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},D=function(e){return function(){var t=Object(O.a)(k.a.mark((function t(a){var n;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A.login(e);case 2:return!1===(n=t.sent).success&&(a({type:"LOGIN_FAIL"}),a({type:"SET_MESSAGE",payload:n.message||n.error})),!0===n.success&&(n.token&&localStorage.setItem("user",JSON.stringify(n)),a({type:"LOGIN_SUCCESS",payload:{user:n}})),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},_=function(e,t){return function(){var a=Object(O.a)(k.a.mark((function a(n){var r;return k.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,A.update(e,t);case 2:return!1===(r=a.sent).success&&(n({type:"UPDATE_FAIL"}),n({type:"SET_MESSAGE",payload:r.message||r.error})),!0===r.success&&(r.token&&localStorage.setItem("user",JSON.stringify(r)),n({type:"UPDATE_USER",payload:{user:r}})),a.abrupt("return",r);case 6:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()},L=function(e){if(!e)return r.a.createElement("div",{className:"alert alert-danger",role:"alert"},"This field is required!")},F=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).onChangeUsername=function(e){n.setState({username:e.target.value})},n.onChangePassword=function(e){n.setState({password:e.target.value})},n.handleLogin=function(){var e=Object(O.a)(k.a.mark((function e(t){var a,r,s,c,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n.setState({loading:!0}),n.form.validateAll(),a=n.props,r=a.dispatch,s=a.history,c=n.state,o=c.username,i=c.password,console.log("login state...",n.state),0!==n.checkBtn.context._errors.length){e.next=14;break}return e.next=9,r(D({username:o,password:i}));case 9:!0===e.sent.success?s.push("/main"):n.setState({loading:!1}),e.next=15;break;case 14:n.setState({loading:!1});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.toRegister=function(){n.props.history.push("/register")},n.state={username:"",password:"",loading:!1},n}return Object(b.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.isLoggedIn,n=t.message;return a?r.a.createElement(x.a,{to:"/main"}):r.a.createElement("div",{className:"col-md-12"},r.a.createElement("div",{className:"card card-container shadow-lg",style:{backgroundColor:"white"}},r.a.createElement("img",{src:"//ssl.gstatic.com/accounts/ui/avatar_2x.png",alt:"profile-img",className:"profile-img-card"}),r.a.createElement(C.a,{onSubmit:this.handleLogin,ref:function(t){e.form=t}},r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Username: "),r.a.createElement("input",{type:"text",name:"username",className:"app-info-input",value:this.state.username,onChange:this.onChangeUsername,style:{border:"none",borderBottom:"solid 2px #eee",width:"178px"}})),r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Password: "),r.a.createElement("input",{type:"password",name:"password",className:"app-info-input",value:this.state.password,onChange:this.onChangePassword,validations:[L],style:{border:"none",borderBottom:"solid 2px #eee",width:"178px"}})),r.a.createElement("div",{className:"form-group pt-3"},r.a.createElement("button",{className:"btn btn-primary btn-block",style:{backgroundColor:"slateblue",border:"none"},disabled:this.state.loading},this.state.loading&&r.a.createElement("span",{className:"spinner-border spinner-border-sm"}),r.a.createElement("span",null,"Login"))),n&&r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"alert alert-danger",role:"alert"},n)),r.a.createElement(N.a,{style:{display:"none"},ref:function(t){e.checkBtn=t}})),r.a.createElement("div",{style:{textAlign:"center"}},"Not a member?",r.a.createElement("a",{onClick:this.toRegister,style:{color:"slateblue",display:"block"}},"Sign up now"))))}}]),a}(n.Component);var U=Object(o.b)((function(e){return{isLoggedIn:e.auth.isLoggedIn,message:e.message.message}}))(F),P=new(function(){function e(){Object(v.a)(this,e)}return Object(b.a)(e,[{key:"uploadAvatar",value:function(e){var t=new FormData;return t.append("file",e),M.a.post("https://arcane-retreat-64091.herokuapp.com/api/upload/avatar",t).then((function(e){return console.log(e),"true"===e.data.success?e.data.path:null})).catch((function(e){return console.log(e),null}))}},{key:"uploadImage",value:function(e){var t=new FormData;return t.append("file",e),M.a.post("https://arcane-retreat-64091.herokuapp.com/api/upload/image",t).then((function(e){return console.log(e),"true"===e.data.success?e.data.path:null})).catch((function(e){return console.log(e),null}))}}]),e}()),B=a(61),G=a.n(B),q=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).onChangeUsername=function(e){n.setState({username:e.target.value})},n.onChangeAge=function(e){n.setState({age:e.target.value})},n.onChangeGender=function(e){n.setState({gender:e.target.value})},n.onChangeLocation=function(e){n.setState({location:e.target.value})},n.onChangeAboutMe=function(e){n.setState({aboutMe:e.target.value})},n.onChangePassword=function(e){n.setState({password:e.target.value})},n.handleRegister=function(){var e=Object(O.a)(k.a.mark((function e(t){var a,r,s,c,o,i,l,u,p;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n.setState({successful:!1}),n.form.validateAll(),a=n.state,r=a.file,s=a.username,c=a.age,o=a.gender,i=a.location,l=a.password,u=a.aboutMe,0!==n.checkBtn.context._errors.length){e.next=13;break}if(!r){e.next=9;break}return e.next=8,P.uploadAvatar(r);case 8:p=e.sent;case 9:return e.next=11,n.props.dispatch(R({username:s,age:c,gender:o,location:i,password:l,aboutMe:u,avatar:p}));case 11:!0===e.sent.success?(n.setState({successful:!0}),n.props.history.push("/login")):n.setState({successful:!1});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleClick=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.hiddenFileInput.current.click();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleChange=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.target.files[0])){e.next=7;break}return console.log(a),e.next=5,n.readURL(a);case 5:return e.next=7,n.setState({file:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.readURL=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&((a=new FileReader).onload=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({avatarSrc:t.target.result});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.readAsDataURL(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.state={username:"",password:"",age:0,gender:"Male",location:"",aboutMe:"",file:null,avatarSrc:null,successful:!1},n.hiddenFileInput=r.a.createRef(),n.locationOptions=G()().getData().map((function(e,t){return r.a.createElement("option",{key:t},e.label)})),n}return Object(b.a)(a,[{key:"render",value:function(){var e=this,t=this.props.message,a=this.state,n=a.file,s=a.avatarSrc;return r.a.createElement("div",{className:"col-md-12"},r.a.createElement("div",{className:"card card-container shadow-lg",style:{backgroundColor:"white"}},r.a.createElement("input",{type:"file",ref:this.hiddenFileInput,onChange:this.handleChange,style:{display:"none"}}),r.a.createElement("img",{src:n?s:"//ssl.gstatic.com/accounts/ui/avatar_2x.png",alt:"profile-img",className:"profile-img-card",onClick:this.handleClick}),r.a.createElement(C.a,{onSubmit:this.handleRegister,ref:function(t){e.form=t}},!this.state.successful&&r.a.createElement("div",null,r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Username: "),r.a.createElement("input",{type:"text",name:"username",className:"app-info-input",autoComplete:"off",value:this.state.username,onChange:this.onChangeUsername,style:{border:"none",borderBottom:"solid 2px #eee"},required:!0})),r.a.createElement("div",{className:"d-flex pt-3 justify-content-between form-group"},r.a.createElement("div",{className:"d-flex form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"gender: "),r.a.createElement("select",{style:{border:"none",borderBottom:"solid 2px #eee"},value:this.state.gender,onChange:this.onChangeGender,required:!0},r.a.createElement("option",null,"Male"),r.a.createElement("option",null,"Female"),r.a.createElement("option",null,"orther"))),r.a.createElement("div",{className:"d-flex form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Age: "),r.a.createElement("input",{type:"number",name:"username",value:this.state.age,autoComplete:"off",onChange:this.onChangeAge,style:{border:"none",borderBottom:"solid 2px #eee",width:"50px"},min:"13",max:"99",required:!0}))),r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Location: "),r.a.createElement("select",{style:{border:"none",borderBottom:"solid 2px #eee",maxWidth:"178px"},value:this.state.location,onChange:this.onChangeLocation,required:!0},this.locationOptions)),r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Password: "),r.a.createElement("input",{type:"password",name:"password",className:"app-info-input",value:this.state.password,onChange:this.onChangePassword,style:{border:"none",borderBottom:"solid 2px #eee"},required:!0})),r.a.createElement("div",{className:"pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"About me: "),r.a.createElement("textarea",{row:"3",value:this.state.aboutMe,onChange:this.onChangeAboutMe,style:{border:"none",borderBottom:"solid 2px #eee",width:"100%"}})),r.a.createElement("div",{className:"form-group pt-3"},r.a.createElement("button",{className:"btn btn-primary btn-block",style:{backgroundColor:"slateblue",border:"none"}},"Sign Up"))),t&&r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:this.state.successful?"alert alert-success":"alert alert-danger",role:"alert"},t)),r.a.createElement(N.a,{style:{display:"none"},ref:function(t){e.checkBtn=t}}))))}}]),a}(n.Component);var W=Object(o.b)((function(e){return{message:e.message.message}}))(q),z=a(41),V=a.n(z),J=a(129),K=a.n(J)()("https://arcane-retreat-64091.herokuapp.com"),H=function(){function e(){Object(v.a)(this,e),this.events={}}return Object(b.a)(e,[{key:"emit",value:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];return this.events[e]&&this.events[e].forEach((function(e){return e.apply(void 0,a)})),this}},{key:"on",value:function(e,t){return this.events[e]?this.events[e].push(t):this.events[e]=[t],this}},{key:"off",value:function(e,t){if(e&&V.a.isFunction(t)){var a=this.events[e],n=a.findIndex((function(e){return e===t}));a.splice(n,1)}else this.events[e]=[];return this}}]),e}(),Y=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(b.a)(a,[{key:"start",value:function(){var e=this;return navigator.mediaDevices.getUserMedia({video:{facingMode:"user",height:{min:360,ideal:720,max:1080}},audio:!0}).then((function(t){e.stream=t,e.emit("stream",t)})).catch((function(e){e instanceof DOMException?alert("Cannot open webcam and/or microphone"):console.log("here..................",e)})),this}},{key:"toggle",value:function(e,t){var a=arguments.length;return this.stream&&this.stream["get".concat(e,"Tracks")]().forEach((function(e){var n=2===a?t:!e.enabled;V.a.set(e,"enabled",n)})),this}},{key:"stop",value:function(){return this.stream&&this.stream.getTracks().forEach((function(e){return e.stop()})),this}}]),a}(H),$={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},Q=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this)).pc=new RTCPeerConnection($),n.pc.onicecandidate=function(e){return K.emit("call",{to:n.friendID,candidate:e.candidate})},n.pc.ontrack=function(e){return n.emit("peerStream",e.streams[0])},n.mediaDevice=new Y,n.friendID=e,n}return Object(b.a)(a,[{key:"start",value:function(e,t){var a=this;return this.mediaDevice.on("stream",(function(t){t.getTracks().forEach((function(e){a.pc.addTrack(e,t)})),a.emit("localStream",t),e?K.emit("request",{to:a.friendID}):a.createOffer()})).start(t),this}},{key:"stop",value:function(e){return e&&K.emit("end",{to:this.friendID}),this.mediaDevice.stop(),this.pc.close(),this.pc=null,this.off(),this}},{key:"createOffer",value:function(){return this.pc.createOffer().then(this.getDescription.bind(this)).catch((function(e){return console.log(e)})),this}},{key:"createAnswer",value:function(){return this.pc.createAnswer().then(this.getDescription.bind(this)).catch((function(e){return console.log(e)})),this}},{key:"getDescription",value:function(e){return this.pc.setLocalDescription(e),K.emit("call",{to:this.friendID,sdp:e}),this}},{key:"setRemoteDescription",value:function(e){var t=new RTCSessionDescription(e);return this.pc.setRemoteDescription(t),this}},{key:"addIceCandidate",value:function(e){if(e){var t=new RTCIceCandidate(e);this.pc.addIceCandidate(t)}return this}}]),a}(H),X=a(49),Z=a(135),ee=a(272),te=a(280),ae=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).handleLocation=function(e){n.setState({location:e.currentTarget.value})},n.handleAge=function(e,t){n.setState({ageMin:t[0],ageMax:t[1]})},n.handleGender=function(e){var t=e.currentTarget;n.setState(Object(X.a)({},t.value,t.checked))},n.submitFilter=Object(O.a)(k.a.mark((function e(){var t,a,r,s,c,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state,a=t.ageMin,r=t.ageMax,s=t.male,c=t.female,o=t.location,i="all",s&&!c?i="Male":!s&&c&&(i="Female"),K.emit("filter",{ageMin:a,ageMax:r,location:o,gender:i}),e.next=6,n.props.toggle();case 6:case"end":return e.stop()}}),e)}))),n.state={ageMin:1,ageMax:100,location:"",male:!0,female:!0},n.locationOptions=G()().getData().map((function(e,t){return r.a.createElement("option",{key:t},e.label)})),n}return Object(b.a)(a,[{key:"render",value:function(){var e=this.state,t=e.ageMin,a=e.ageMax;return r.a.createElement("div",{className:"hide-overflow",style:{overflowY:"auto",padding:"15px"}},r.a.createElement("div",{className:"d-flex align-items-center justify-content-between",style:{borderBottom:"2px solid grey"}},r.a.createElement("div",{className:"d-flex"},r.a.createElement("i",{className:"fa fa-search",style:{paddingRight:"5px",color:"black"}}),r.a.createElement("h4",null,"Filter")),r.a.createElement("i",{className:"fas fa-times my-cursor",onClick:this.props.toggle})),r.a.createElement("div",{style:{padding:"1vw"}},r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Location: "),r.a.createElement("select",{style:{border:"none",borderBottom:"solid 2px #eee",maxWidth:"178px",backgroundColor:"#fafafa"},value:this.state.location,onChange:this.handleLocation,required:!0},this.locationOptions)),r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Age Range: "),r.a.createElement(te.a,{min:13,max:99,value:[t,a],onChange:this.handleAge,valueLabelDisplay:"auto","aria-labelledby":"range-slider"})),r.a.createElement("div",{className:"d-flex pt-3 form-group align-items-center"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Gender: "),r.a.createElement(ee.a,{value:"male",control:r.a.createElement(Z.a,{color:"primary"}),label:"Male",labelPlacement:"end",checked:this.state.male,onChange:this.handleGender}),r.a.createElement(ee.a,{value:"female",control:r.a.createElement(Z.a,{color:"primary"}),label:"Female",labelPlacement:"end",checked:this.state.female,onChange:this.handleGender}))),r.a.createElement("div",{className:"form-group pt-3"},r.a.createElement("button",{className:"btn btn-primary btn-block",onClick:this.submitFilter,style:{backgroundColor:"slateblue",border:"none"}},"Apply")))}}]),a}(n.Component),ne=a(273),re="https://arcane-retreat-64091.herokuapp.com/api/report",se={sendReport:function(e){return M.a.post(re,Object(p.a)({},e)).then((function(e){return e.data})).catch((function(e){return console.log(e),{success:"false",message:"Some errors occured, try again"}}))},getAll:function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.a.get(re+"/getAll",{headers:{token:t}});case 3:return a=e.sent,e.abrupt("return",a.data);case 7:return e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",{success:!1,error:"some errors occured in client side"});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},ce=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).handleUsername=function(e){n.isMt&&!n.props.friendInfo&&n.setState({username:e.currentTarget.value})},n.handleDescription=function(e){n.isMt&&n.setState({description:e.currentTarget.value})},n.submitReport=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!n.isMt){e.next=4;break}return e.next=4,n.setState({msg:null});case 4:return e.next=6,se.sendReport({to:n.state.username,description:n.state.description,from:n.props.myId});case 6:if(a=e.sent,console.log("report result",a),!0!==a.success){e.next=15;break}return K.emit("report"),n.isMt&&n.setState({username:n.props.friendInfo?n.props.friendInfo.username:"",description:"",msg:null}),e.next=13,n.props.toggle();case 13:e.next=16;break;case 15:n.isMt&&n.setState({msg:a.message});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.state={username:n.props.friendInfo?n.props.friendInfo.username:"",description:"",msg:null},n.isMt=!1,n}return Object(b.a)(a,[{key:"componentDidMount",value:function(){this.isMt=!0}},{key:"componentWillUnmount",value:function(){this.isMt=!1}},{key:"render",value:function(){return r.a.createElement("div",{className:"hide-overflow",style:{overflowY:"auto",padding:"15px",width:"250px"}},r.a.createElement("div",{className:"d-flex align-items-center justify-content-between",style:{borderBottom:"2px solid grey"}},r.a.createElement("div",{className:"d-flex"},r.a.createElement("i",{className:"fa fa-envelope-open-text",style:{paddingRight:"5px",color:"black"}}),r.a.createElement("h4",null,"Report")),r.a.createElement("i",{className:"fas fa-times my-cursor",onClick:this.props.toggle})),r.a.createElement("form",{style:{padding:"1vw"}},r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement(ne.a,{placeholder:"Username",inputProps:{"aria-label":"description"},value:this.props.friendInfo?this.props.friendInfo.username:this.state.username,onChange:this.handleUsername,required:!0})),r.a.createElement("div",{className:"pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"description: "),r.a.createElement("textarea",{row:"20",value:this.state.description,onChange:this.handleDescription,style:{border:"none",borderBottom:"solid 2px #eee",width:"100%",backgroundColor:"#fafafa",height:"20vh"},required:!0})),r.a.createElement("div",{className:"form-group pt-3"},r.a.createElement("button",{className:"btn btn-primary btn-block",type:"submit",onClick:this.submitReport,style:{backgroundColor:"slateblue",border:"none"}},"Report")),this.state.msg&&r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"alert alert-danger",role:"alert"},this.state.msg))))}}]),a}(n.Component),oe="https://arcane-retreat-64091.herokuapp.com",ie=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).logOut=Object(O.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.endCall(!0);case 2:return e.next=4,n.props.dispatch((n.props.user,function(e){e({type:"LOGOUT"})}));case 4:window.location.reload();case 5:case"end":return e.stop()}}),e)}))),n.skip=Object(O.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.isMt){e.next=3;break}return e.next=3,n.props.skip();case 3:case"end":return e.stop()}}),e)}))),n.toggle=function(e){return Object(O.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.isMt){t.next=10;break}return t.next=3,n.setState(Object(X.a)({},e,!n.state[e]));case 3:if("filter"!==e||!0!==n.state.filter){t.next=6;break}return t.next=6,n.setState({report:!1});case 6:if("report"!==e||!0!==n.state.report){t.next=9;break}return t.next=9,n.setState({filter:!1});case 9:console.log("navbar toggeld..",e,n.state);case 10:case"end":return t.stop()}}),t)})))},n.state={filter:!1,report:!1},n.isMt=!1,n}return Object(b.a)(a,[{key:"componentDidMount",value:function(){this.isMt=!0}},{key:"render",value:function(){return r.a.createElement("div",{className:"navbar navbar-expand-sm bg-grey navbar-grey d-flex justify-content-between app-navbar align-items-center"},r.a.createElement("div",null,r.a.createElement("i",{className:"fas fa-times my-cursor"})),r.a.createElement("div",null,r.a.createElement("i",{className:"fa fa-sync-alt",onClick:this.skip,style:{fontSize:"4vh"}})),r.a.createElement("div",{className:"d-flex align-items-center"},r.a.createElement("div",{className:"app-dropdown"},r.a.createElement("i",{className:"fa fa-envelope-open-text my-cursor",onClick:this.toggle("report")},"Report"),r.a.createElement("div",{className:"app-dropdown-content-center d-block"},this.state.report&&r.a.createElement(ce,{friendInfo:this.props.friendInfo,myId:this.props.user.user._id,toggle:this.toggle("report")}))),r.a.createElement("div",{className:"app-dropdown"},r.a.createElement("i",{className:"fas fa-search my-cursor",onClick:this.toggle("filter")},"Filter"),r.a.createElement("div",{className:"app-dropdown-content d-block"},this.state.filter&&r.a.createElement(ae,{toggle:this.toggle("filter")}))),r.a.createElement("div",{className:"app-dropdown",style:{float:"right"}},r.a.createElement("img",{src:this.props.user.user.avatar?"".concat(oe).concat(this.props.user.user.avatar):"".concat(oe,"/public/avatar/myavatar.jpg"),alt:"John Doe",className:"rounded-circle shadow my-cursor app-user-avatar app-btn"}),r.a.createElement("div",{className:"app-dropdown-content"},r.a.createElement("div",{onClick:this.props.toggleProfile,className:"app-menu-item app-btn"},"Profile"),r.a.createElement("hr",{style:{padding:"0px",margin:"0px",width:"100%"}}),r.a.createElement("div",{onClick:this.logOut,className:"app-menu-item app-btn"},r.a.createElement("i",{className:"fa fa-sign-out-alt"},"Log out"))))))}}]),a}(n.Component);var le=Object(o.b)((function(e){return{user:e.auth.user}}))(ie),ue=a(17);var pe=function(e){var t=e.peerSrc,a=e.localSrc,s=e.config,c=e.mediaDevice,o=(e.status,e.endCall,Object(n.useRef)(null)),i=Object(n.useRef)(null),l=Object(n.useState)(s.video),u=Object(ue.a)(l,2),p=u[0],d=u[1],m=Object(n.useState)(s.audio),f=Object(ue.a)(m,2),g=f[0],h=f[1];Object(n.useEffect)((function(){o.current&&t&&(o.current.srcObject=t),i.current&&a&&(i.current.srcObject=a)})),Object(n.useEffect)((function(){c&&(c.toggle("Video",p),c.toggle("Audio",g))}));var v=function(e){"video"===e&&(d(!p),c.toggle("Video")),"audio"===e&&(h(!g),c.toggle("Audio"))};return r.a.createElement("div",{className:"d-flex app-video-panel"},r.a.createElement("div",{className:"app-video-panel-wrapper"},t?r.a.createElement("video",{className:"app-video-player",ref:o,autoPlay:!0}):r.a.createElement("img",{src:"./system/screen.png",className:" app-video-player",alt:"Cinque Terre"})),r.a.createElement("div",{className:"fade-container app-video-panel-wrapper",style:{alignItems:"center"}},a?r.a.createElement("video",{className:"fade-image app-video-player",ref:i,autoPlay:!0,muted:!0}):r.a.createElement("img",{src:"./system/screen.png",className:"fade-image app-video-player",alt:"Cinque Terre"}),r.a.createElement("div",{className:"fade-middle d-flex"},r.a.createElement("div",{className:"fade-text my-cursor app-btn",onClick:function(){return v("audio")}},"audio ",g?"on":"off"),r.a.createElement("div",{className:"fade-text my-cursor app-btn",onClick:function(){return v("video")}},"video ",p?"on":"off"))))},de=a(32),me="https://arcane-retreat-64091.herokuapp.com",fe=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(){var e;Object(v.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).LeftMsg=function(){return r.a.createElement("div",{className:"d-flex app-msg-p"},r.a.createElement("img",{src:e.props.avatar?"".concat(me).concat(e.props.avatar):"".concat(me,"/public/avatar/unknown.png"),alt:"",className:"rounded-circle my-cursor app-msg-client-avatar",onClick:e.props.toggle()}),r.a.createElement("div",{className:"app-max-width-70"},r.a.createElement("div",{className:" shadow app-msg-left"},e.props.msg.text),r.a.createElement("p",{className:"app-color-grey"},e.props.msg.time)))},e.RightMsg=function(){return r.a.createElement("div",{className:"d-flex justify-content-end app-msg-p"},r.a.createElement("div",{className:"app-max-width-70"},r.a.createElement("div",{className:"shadow app-msg-right"},e.props.msg.text),r.a.createElement("p",{className:"app-color-grey app-textalign-right"},e.props.msg.time)))},e.LeftFileMsg=function(){return r.a.createElement("div",{className:"d-flex app-msg-p"},r.a.createElement("img",{src:e.props.avatar?"".concat(me).concat(e.props.avatar):"".concat(me,"/public/avatar/unknown.png"),alt:"",className:"rounded-circle my-cursor app-msg-client-avatar",onClick:e.props.toggle()}),r.a.createElement("div",null,r.a.createElement("div",{className:" shadow fade-container app-msg-img-border"},r.a.createElement("img",{src:me+e.props.msg.src,alt:"",className:"fade-image my-cursor app-file-upload-img"}),r.a.createElement("div",{className:"fade-middle d-flex"},r.a.createElement("div",{className:"fade-text my-cursor app-btn",onClick:e.props.viewImage(me+e.props.msg.src)},"View"),r.a.createElement("div",{className:"fade-text my-cursor app-btn"},r.a.createElement("a",{target:"_blank",href:me+e.props.msg.src,className:"app-download",download:!0},"Download")))),r.a.createElement("p",{className:"app-color-grey"},e.props.msg.time)))},e.RightFileMsg=function(){return r.a.createElement("div",{className:"d-flex justify-content-end app-msg-p"},r.a.createElement("div",null,r.a.createElement("div",{className:"shadow fade-container my-cursor app-msg-img-border"},r.a.createElement("img",{src:me+e.props.msg.src,alt:"",className:"fade-image app-file-upload-img"}),r.a.createElement("div",{className:"fade-middle d-flex"},r.a.createElement("div",{className:"fade-text my-cursor app-btn",onClick:e.props.viewImage(me+e.props.msg.src)},"View"),r.a.createElement("div",{className:"fade-text my-cursor app-btn"},r.a.createElement("a",{target:"_blank",href:me+e.props.msg.src,className:"app-download",download:!0},"Download")))),r.a.createElement("p",{className:"app-color-grey app-textalign-right"},e.props.msg.time)))},e}return Object(b.a)(a,[{key:"render",value:function(){var e=this.props.msg.type;return"left_msg"===e?this.LeftMsg():"right_msg"===e?this.RightMsg():"left_file_msg"===e?this.LeftFileMsg():"right_file_msg"===e?this.RightFileMsg():null}}]),a}(n.Component);var ge=Object(o.b)((function(e){return{user:e.auth.user}}))(fe),he=(a(219),a(132)),ve="https://arcane-retreat-64091.herokuapp.com",be=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).onEmojiClick=function(e,t){console.log("Emoji",e),n.setState({text:n.state.text+e.native})},n.sendTyping=function(){console.log("sendTyping..."),n.lastUpdateTime=Date.now(),n.state.isTyping||(n.setState({isTyping:!0}),K.emit("msg_typing",{to:n.props.friendId,status:!0}),n.startCheckingTyping())},n.startCheckingTyping=function(){console.log("Typing"),n.typingInterval=setInterval((function(){Date.now()-n.lastUpdateTime>300&&(n.setState({isTyping:!1}),n.stopCheckingTyping())}),300)},n.stopCheckingTyping=function(){console.log("Stop Typing"),n.typingInterval&&(clearInterval(n.typingInterval),K.emit("msg_typing",{to:n.props.friendId,status:!1}))},n.sendMsg=function(){var e=Object(O.a)(k.a.mark((function e(t){var a,r,s,c,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),console.log("send button cliked..."),a=n.state,r=a.text,s=a.file,c=n.props.friendId,null==s){e.next=9;break}return e.next=7,P.uploadImage(s);case 7:(o=e.sent)&&(K.emit("new_msg",{to:c,msg:{type:"left_file_msg",src:o}}),n.props.getMsg({type:"right_file_msg",src:o}));case 9:""!==r&&(K.emit("new_msg",{to:c,msg:{type:"left_msg",text:r}}),n.props.getMsg({type:"right_msg",text:r})),n.setState({text:"",file:null,fileSrc:null,emojiBox:"hidden"});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleText=function(e){n.setState({text:e.currentTarget.value})},n.handleClick=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.hiddenFileInput.current.click();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleChange=function(){var e=Object(O.a)(k.a.mark((function e(t){var a,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.target.files[0])){e.next=10;break}if(console.log(a),"jpg"===(r=a.name.split(".").pop().toLowerCase())||"png"===r||"gif"===r||"jpeg"===r||"bmp"===r){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,n.readURL(a);case 8:return e.next=10,n.setState({file:a});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.readURL=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&((a=new FileReader).onload=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({fileSrc:t.target.result});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.readAsDataURL(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleCloseFileupload=function(){n.setState({file:null,fileSrc:null})},n.handleEmojiBox=function(){n.setState({emojiBox:"hidden"===n.state.emojiBox?"visible":"hidden"})},n.state={isTyping:!1,text:"",file:null,fileSrc:null,emojiBox:"hidden"},n.hiddenFileInput=r.a.createRef(),n}return Object(b.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"position-relative"},r.a.createElement("div",{className:"app-emoji-picker",style:{visibility:this.state.emojiBox}},r.a.createElement(he.a,{onSelect:this.onEmojiClick})),this.props.friendTyping&&r.a.createElement("div",{className:"dotsContainer shadow app-typing"},r.a.createElement("img",{src:this.props.avatar?"".concat(ve).concat(this.props.avatar):"".concat(ve,"/public/avatar/unknown.png"),alt:"",className:"rounded-circle my-cursor app-msg-client-avatar"}),r.a.createElement("span",{id:"dot1"}),r.a.createElement("span",{id:"dot2"}),r.a.createElement("span",{id:"dot3"})),r.a.createElement("form",{onSubmit:this.sendMsg,className:"chat-box-tray h-7vh position-relative"},this.state.fileSrc&&r.a.createElement("div",{className:"position-absolute app-file-upload"},r.a.createElement("div",{className:"position-relative"},r.a.createElement("img",{src:this.state.fileSrc,alt:"",className:"app-file-upload-img"}),r.a.createElement("div",{className:"app-topright"},r.a.createElement("i",{className:"fas fa-times my-cursor app-cross",onClick:this.handleCloseFileupload})))),r.a.createElement("div",{className:"d-flex  app-msg-input-wrapper"},r.a.createElement("i",{className:"material-icons my-cursor",style:{fontSize:"5vh"},onClick:this.handleEmojiBox},"sentiment_very_satisfied"),r.a.createElement("input",{type:"text",className:"app-msg-input",placeholder:" Type your message here... ",value:this.state.text,onKeyUp:function(t){13!==t.keyCode&&e.sendTyping()},onChange:this.handleText,style:{fontSize:"14px"}})),r.a.createElement("div",null,r.a.createElement("i",{className:"fa fa-image my-cursor ",style:{fontSize:"5vh"},onClick:this.handleClick}),r.a.createElement("input",{type:"file",ref:this.hiddenFileInput,onChange:this.handleChange,style:{display:"none"}})),r.a.createElement("div",null,r.a.createElement("i",{className:"fa fa-paper-plane my-cursor",style:{fontSize:"5vh"},onClick:this.sendMsg}))))}}]),a}(n.Component),Ee=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).scrollDown=function(){var e=n.refs.container;e.scrollTop=e.scrollHeight},n.resetChat=function(){var e=n.state.chats;K.on("msg_typing",function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.from===n.props.friendId&&n.mtFlag&&n.setState({friendTyping:t.status});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),K.on("new_msg",(function(t){t.from===n.props.friendId&&(t.msg.time=n.getTime(new Date(Date.now())),n.mtFlag&&n.setState({chats:[].concat(Object(de.a)(n.state.chats),[t.msg])}),console.log("after receive msg",e))}))},n.getTime=function(e){return"".concat(e.getHours(),":").concat(("0"+e.getMinutes()).slice(-2))},n.renderMsg=function(){return n.state.chats.map((function(e,t){return r.a.createElement(ge,{key:t,msg:e,toggle:n.props.toggle,viewImage:n.props.viewImage,avatar:n.props.avatar})}))},n.getMsg=function(e){n.mtFlag&&n.setState({chats:[].concat(Object(de.a)(n.state.chats),[Object(p.a)(Object(p.a)({},e),{},{time:n.getTime(new Date(Date.now()))})])})},n.state={chats:[],friendTyping:!1},n.mtFlag=!1,n}return Object(b.a)(a,[{key:"componentDidMount",value:function(){this.mtFlag=!0,this.scrollDown(),this.props.friendId&&this.resetChat()}},{key:"componentWillUnmount",value:function(){this.mtFlag=!1}},{key:"componentDidUpdate",value:function(e,t){this.scrollDown()}},{key:"render",value:function(){return r.a.createElement("div",{className:"d-flex flex-fill flex-column"},r.a.createElement("div",{ref:"container",className:"hide-overflow app-msg-box"},this.renderMsg()),r.a.createElement(be,{getMsg:this.getMsg,friendId:this.props.friendId,avatar:this.props.avatar,friendTyping:this.state.friendTyping}))}}]),a}(n.Component),ye="https://arcane-retreat-64091.herokuapp.com",xe=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(b.a)(a,[{key:"render",value:function(){console.log("toggle",this.props.toggle);var e=this.props.info;return r.a.createElement("div",{className:"app-client-profile-background",style:{backgroundImage:"url(".concat(e.avatar?"".concat(ye).concat(e.avatar):"".concat(ye,"/public/avatar/unknown.png"),")")}},r.a.createElement("div",{className:"d-flex flex-column align-items-center app-client-profile"},r.a.createElement("div",{className:"app-cross-div"},r.a.createElement("i",{className:"fas fa-times my-cursor app-cross",onClick:this.props.toggle()})),r.a.createElement("img",{src:e.avatar?"".concat(ye).concat(e.avatar):"".concat(ye,"/public/avatar/unknown.png"),className:"rounded-circle app-client-avatar",alt:"Cinque Terre"}),r.a.createElement("h5",{className:"app-client-name"},e.username),r.a.createElement("p",null,r.a.createElement("i",{className:"fa fa-map-marker-alt",style:{color:"#eee"}}),e.location),r.a.createElement("div",{className:"app-profile-desc"},r.a.createElement("p",null,"Gender: ",e.gender),r.a.createElement("p",null,"Age: ",e.age),r.a.createElement("p",null,"About Me:"),r.a.createElement("p",null," ",e.aboutMe))))}}]),a}(n.Component),we=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(b.a)(a,[{key:"render",value:function(){return console.log("viewImage",this.props.src),r.a.createElement("div",{className:"image-modal"},r.a.createElement("span",{className:"close",onClick:this.props.toggle("")},"\xd7"),r.a.createElement("img",{src:this.props.src,className:"modal-content",alt:""}))}}]),a}(n.Component),ke=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(b.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"app-loading"},r.a.createElement("div",{className:"dotsContainer"},r.a.createElement("h1",null,"Finding"),r.a.createElement("span",{id:"dot1"}),r.a.createElement("span",{id:"dot2"}),r.a.createElement("span",{id:"dot3"})))}}]),a}(n.Component),Oe="https://arcane-retreat-64091.herokuapp.com",je=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;Object(v.a)(this,a),(n=t.call(this,e)).onChangeUsername=function(e){n.setState({username:e.target.value})},n.onChangeAge=function(e){n.setState({age:e.target.value})},n.onChangeGender=function(e){n.setState({gender:e.target.value})},n.onChangeLocation=function(e){n.setState({location:e.target.value})},n.onChangeAboutMe=function(e){n.setState({aboutMe:e.target.value})},n.onChangePassword=function(e){n.setState({password:e.target.value})},n.handleUpdate=function(){var e=Object(O.a)(k.a.mark((function e(t){var a,r,s,c,o,i,l,u,p;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n.setState({successful:!1}),n.form.validateAll(),a=n.state,r=a.file,s=a.username,c=a.age,o=a.gender,i=a.location,l=a.password,u=a.aboutMe,0!==n.checkBtn.context._errors.length){e.next=15;break}if(!r){e.next=9;break}return e.next=8,P.uploadAvatar(r);case 8:p=e.sent;case 9:return e.next=11,n.props.dispatch(_({username:s,age:c,gender:o,location:i,password:l,aboutMe:u,avatar:p},n.props.user.token));case 11:!0===e.sent.success?n.props.toggleProfile():n.setState({loading:!1}),e.next=16;break;case 15:n.setState({loading:!1});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleClick=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.hiddenFileInput.current.click();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleChange=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.target.files[0])){e.next=7;break}return console.log(a),e.next=5,n.readURL(a);case 5:return e.next=7,n.setState({file:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.readURL=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&((a=new FileReader).onload=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({avatarSrc:t.target.result});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.readAsDataURL(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var s=n.props.user.user;return n.state={username:s.username,password:s.password,age:s.age,gender:s.gender,location:s.location,aboutMe:s.aboutMe,file:null,avatarSrc:null,successful:!1},n.hiddenFileInput=r.a.createRef(),n.locationOptions=G()().getData().map((function(e,t){return r.a.createElement("option",{key:t},e.label)})),n}return Object(b.a)(a,[{key:"render",value:function(){var e=this,t=this.props.message,a=this.state,n=a.file,s=a.avatarSrc;return r.a.createElement("div",{className:"col-md-12"},r.a.createElement("div",{className:"card card-container shadow-lg",style:{backgroundColor:"white"}},r.a.createElement("i",{className:"fa fa-arrow-left app-back-icon",onClick:this.props.toggleProfile}),r.a.createElement("input",{type:"file",ref:this.hiddenFileInput,onChange:this.handleChange,style:{display:"none"}}),r.a.createElement("img",{src:n?s:this.props.user.user.avatar?"".concat(Oe).concat(this.props.user.user.avatar):"".concat(Oe,"/public/avatar/myavatar.jpg"),alt:"profile-img",className:"profile-img-card",onClick:this.handleClick}),r.a.createElement(C.a,{onSubmit:this.handleUpdate,ref:function(t){e.form=t}},!this.state.successful&&r.a.createElement("div",null,r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Username: "),r.a.createElement("input",{type:"text",name:"username",className:"app-info-input",value:this.state.username,onChange:this.onChangeUsername,style:{border:"none",borderBottom:"solid 2px #eee"},required:!0})),r.a.createElement("div",{className:"d-flex pt-3 justify-content-between form-group"},r.a.createElement("div",{className:"d-flex form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"gender: "),r.a.createElement("select",{style:{border:"none",borderBottom:"solid 2px #eee"},value:this.state.gender,onChange:this.onChangeGender,required:!0},r.a.createElement("option",null,"Male"),r.a.createElement("option",null,"Female"),r.a.createElement("option",null,"orther"))),r.a.createElement("div",{className:"d-flex form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Age: "),r.a.createElement("input",{type:"number",name:"username",value:this.state.age,onChange:this.onChangeAge,style:{border:"none",borderBottom:"solid 2px #eee",width:"50px"},min:"3",max:"150",required:!0}))),r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Location: "),r.a.createElement("select",{style:{border:"none",borderBottom:"solid 2px #eee",maxWidth:"178px"},value:this.state.location,onChange:this.onChangeLocation,required:!0},this.locationOptions)),r.a.createElement("div",{className:"d-flex pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"Password: "),r.a.createElement("input",{type:"password",name:"password",className:"app-info-input",value:this.state.password,onChange:this.onChangePassword,style:{border:"none",borderBottom:"solid 2px #eee"}})),r.a.createElement("div",{className:"pt-3 form-group"},r.a.createElement("div",{style:{color:"#ccc",paddingRight:"6px"}},"About me: "),r.a.createElement("textarea",{row:"3",value:this.state.aboutMe,onChange:this.onChangeAboutMe,style:{border:"none",borderBottom:"solid 2px #eee",width:"100%"}})),r.a.createElement("div",{className:"form-group pt-3"},r.a.createElement("button",{className:"btn btn-primary btn-block",style:{backgroundColor:"slateblue",border:"none"}},"Update"))),t&&r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:this.state.successful?"alert alert-success":"alert alert-danger",role:"alert"},t)),r.a.createElement(N.a,{style:{display:"none"},ref:function(t){e.checkBtn=t}}))))}}]),a}(n.Component);var Ce=Object(o.b)((function(e){var t=e.auth.user;return{message:e.message.message,user:t}}))(je),Se=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).getFriend=function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.getFriendInfo(t,n.props.user.token);case 2:a=e.sent,console.log("Get friend info from server",a),!0===a.success?n.setState({friendInfo:a.user}):(console.log("Getting friend info from server failed"),n.setState({friendInfo:null}),n.endCall(!0));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.skip=Object(O.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("skip..current friendId",n.state.friend),e.next=3,n.endCall(!0);case 3:K.emit("finding");case 4:case"end":return e.stop()}}),e)}))),n.startCall=function(){var e=Object(O.a)(k.a.mark((function e(t,a,r){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("start call...",t,a,r),n.config=r,n.pc=new Q(a).on("localStream",function(){var e=Object(O.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={localSrc:t},e.next=3,n.setState(a);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).on("peerStream",function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({peerSrc:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).start(t,r);case 3:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),n.endCall=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("end call to...",n.state.friendId,t),!V.a.isFunction(n.pc.stop)){e.next=4;break}return e.next=4,n.pc.stop(t);case 4:return n.pc={},n.config=null,e.next=8,n.setState({localSrc:null,peerSrc:null,clientProfileFlag:!1,friendId:"",viewImg:"",friendInfo:null});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.toggleFriendFlag=function(e){return Object(O.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({clientProfileFlag:!n.state.clientProfileFlag});case 2:case"end":return e.stop()}}),e)})))},n.viewImage=function(e){return Object(O.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.setState({viewImg:e});case 2:case"end":return t.stop()}}),t)})))},n.toggleProfile=Object(O.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({profile:!n.state.profile});case 2:n.state.profile?n.endCall(!0):K.emit("finding");case 3:case"end":return e.stop()}}),e)}))),console.log(n.props.user),n.state={clientId:"",localSrc:null,peerSrc:null,clientProfileFlag:!1,friendId:"",viewImg:"",friendInfo:null,profile:!1},n.pc={},n.config=null,n}return Object(b.a)(a,[{key:"componentDidMount",value:function(){var e=this;console.log("Main component mounted, current User: ",this.props.user),document.title=this.props.user.user.username,K.on("init",function(){var t=Object(O.a)(k.a.mark((function t(a){var n;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=a.id,console.log("client id..",n),e.endCall(!1),K.emit("finding");case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).on("request",function(){var t=Object(O.a)(k.a.mark((function t(a){var n;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.from,console.log("call request from...",n),e.getFriend(n),t.next=5,e.setState({friendId:n});case 5:return t.next=7,e.startCall(!1,n,{audio:!0,video:!0});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).on("call",function(){var t=Object(O.a)(k.a.mark((function t(a){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!a.sdp){t.next=9;break}return t.next=4,e.pc.setRemoteDescription(a.sdp);case 4:if("offer"!==a.sdp.type){t.next=7;break}return t.next=7,e.pc.createAnswer();case 7:t.next=11;break;case 9:return t.next=11,e.pc.addIceCandidate(a.candidate);case 11:t.next=19;break;case 13:return t.prev=13,t.t0=t.catch(0),console.log("!!!Error::",t.t0),t.next=18,e.endCall(!0);case 18:K.emit("finding");case 19:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(e){return t.apply(this,arguments)}}()).on("finding",function(){var t=Object(O.a)(k.a.mark((function t(a){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("finding from server ",a),"null"!==a){t.next=5;break}setTimeout((function(){return K.emit("finding")}),1500),t.next=10;break;case 5:return e.getFriend(a),t.next=8,e.setState({friendId:a});case 8:return t.next=10,e.startCall(!0,a,{audio:!0,video:!0});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).on("end",function(){var t=Object(O.a)(k.a.mark((function t(a){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("call end message from..."),e.state.friendId!==a&&"fromServerSocket"!==a){t.next=5;break}return t.next=4,e.endCall(!1);case 4:K.emit("finding");case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).on("reset",Object(O.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.endCall(!0);case 2:K.emit("init",e.props.user.user._id);case 3:case"end":return t.stop()}}),t)})))).emit("init",this.props.user.user._id)}},{key:"componentWillUnmount",value:function(){this.endCall(!0),K.disconnect(),console.log("main component will unmount now...",this.pc)}},{key:"render",value:function(){var e=this.state,t=e.viewImg,a=e.localSrc,n=e.peerSrc,s=e.clientProfileFlag,c=(e.friendId,e.friendInfo);return r.a.createElement("div",null," ",!this.state.profile&&r.a.createElement("div",{className:"container-fluid shadow-lg app-main-div"},r.a.createElement(le,{history:this.props.history,skip:this.skip,endCall:this.endCall,toggleProfile:this.toggleProfile,friendInfo:this.state.friendInfo}),r.a.createElement("div",{className:"d-flex app-board"},V.a.isEmpty(this.config)&&!c&&r.a.createElement(ke,null),!V.a.isEmpty(this.config)&&c&&r.a.createElement(pe,{localSrc:a,peerSrc:n,config:this.config,mediaDevice:this.pc.mediaDevice}),!V.a.isEmpty(this.config)&&c&&r.a.createElement(Ee,{toggle:this.toggleFriendFlag,viewImage:this.viewImage,friendId:this.state.friendId,avatar:this.state.friendInfo.avatar}),!V.a.isEmpty(this.config)&&c&&s&&r.a.createElement(xe,{clientInfo:this.state.friendInfo,toggle:this.toggleFriendFlag,info:this.state.friendInfo})),""!==t&&r.a.createElement(we,{src:t,toggle:this.viewImage})),this.state.profile&&r.a.createElement(Ce,{toggleProfile:this.toggleProfile}))}}]),a}(n.Component);var Ne=Object(o.b)((function(e){return{user:e.auth.user,isLoggedIn:e.auth.isLoggedIn}}))(Se),Ie=a(133),Me="https://arcane-retreat-64091.herokuapp.com/api/ban",Te={create:function(e,t){return M.a.post(Me,{ip:e},{headers:{token:t}}).then((function(e){return e.data})).catch((function(e){return console.log(e),{success:"false",message:"Some errors occured, try again"}}))},delete:function(e,t){return M.a.delete(Me,{id:e},{headers:{token:t}}).then((function(e){return e.data})).catch((function(e){return console.log(e),{success:"false",message:"Some errors occured, try again"}}))},createAccount:function(e,t){return M.a.post(Me+"/account/".concat(e),{},{headers:{token:t}}).then((function(e){return e.data})).catch((function(e){return console.log(e),{success:"false",message:"Some errors occured, try again"}}))},deleteAccount:function(e,t){return M.a.delete(Me+"/account/".concat(e),{},{headers:{token:t}}).then((function(e){return e.data})).catch((function(e){return console.log(e),{success:"false",message:"Some errors occured, try again"}}))},getAll:function(e){return M.a.get(Me+"/getAll",{},{headers:{token:e}}).then((function(e){return e.data})).catch((function(e){return console.log(e),{success:"false",message:"Some errors occured, try again"}}))}},Ae=a(130),Re=[{field:"username",headerName:"Name"},{field:"ip",headerName:"IP"},{field:"location",headerName:"Location"},{field:"age",headerName:"Age",type:"number"},{field:"gender",headerName:"Gender"},{field:"status",headerName:"Status"}],De=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){return Object(v.a)(this,a),t.call(this,e)}return Object(b.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{style:{height:400,width:"100%"}},r.a.createElement(Ae.a,{rows:this.props.rows,columns:Re,pageSize:5,checkboxSelection:!0}))}}]),a}(r.a.Component),_e=a(227),Le=a(275),Fe=a(278),Ue=a(276),Pe=a(277),Be=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).init=Object(O.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.getAll("Password1qaz=]'/ThisisAdmin");case 2:if(!0!==(t=e.sent).success){e.next=6;break}return e.next=6,n.setState({users:t.users.map((function(e,t){return{id:t,username:e.username,ip:"undefined",location:e.location,age:e.age,gender:e.gender,status:e.status}}))});case 6:return e.next=8,Te.getAll("Password1qaz=]'/ThisisAdmin");case 8:return!0===(t=e.sent).success&&(n.bans=t.bans),e.next=12,se.getAll("Password1qaz=]'/ThisisAdmin");case 12:!0===(t=e.sent).success&&(n.reports=t.reports),console.log("admin states...",n.state);case 15:case"end":return e.stop()}}),e)}))),n.handleChange=function(e,t){n.setState({value:t})},n.state={users:[],value:0},n}return Object(b.a)(a,[{key:"componentDidMount",value:function(){this.init(),K.emit("admin_getUsers"),K.on("admin_getUsers",function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("...data from server,,",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"render",value:function(){var e=this.state.value;return r.a.createElement("div",null,r.a.createElement(Le.a,{position:"static"},r.a.createElement(Fe.a,{variant:"fullWidth",value:e,onChange:this.handleChange,"aria-label":"nav tabs example"},r.a.createElement(We,Object.assign({label:"Page One"},qe(0))),r.a.createElement(We,Object.assign({label:"Page Two"},qe(1))),r.a.createElement(We,Object.assign({label:"Page Three"},qe(2))))),r.a.createElement(Ge,{value:e,index:0},r.a.createElement(De,{rows:this.state.users})),r.a.createElement(Ge,{value:e,index:1},"Page Two"),r.a.createElement(Ge,{value:e,index:2},"Page Three"))}}]),a}(r.a.Component);function Ge(e){var t=e.children,a=e.value,n=e.index,s=Object(Ie.a)(e,["children","value","index"]);return r.a.createElement("div",Object.assign({role:"tabpanel",hidden:a!==n,id:"nav-tabpanel-".concat(n),"aria-labelledby":"nav-tab-".concat(n)},s),a===n&&r.a.createElement(Pe.a,{p:3},t))}function qe(e){return{id:"nav-tab-".concat(e),"aria-controls":"nav-tabpanel-".concat(e)}}function We(e){return r.a.createElement(Ue.a,Object.assign({component:"a",onClick:function(e){e.preventDefault()}},e))}Object(_e.a)((function(e){return{root:{flexGrow:1,backgroundColor:e.palette.background.paper}}}));var ze=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(b.a)(a,[{key:"render",value:function(){return this.props.user&&this.props.isLoggedIn?r.a.createElement(x.b,this.props):r.a.createElement(x.a,{to:"/login"})}}]),a}(n.Component);var Ve=Object(o.b)((function(e){var t=e.auth;return{user:t.user,isLoggedIn:t.isLoggedIn}}))(ze),Je=a(43),Ke=Object(Je.a)(),He=function(e){Object(E.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).logOut=function(){n.props.dispatch((n.props.user,function(e){e({type:"LOGOUT"})}))},n.state={currentUser:void 0},Ke.listen((function(t){e.dispatch({type:"CLEAR_MESSAGE"})})),n}return Object(b.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.user;e&&this.setState({currentUser:e})}},{key:"render",value:function(){return console.log("env testing...",Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_API_URL:"https://arcane-retreat-64091.herokuapp.com/api",REACT_APP_SOCK:"https://arcane-retreat-64091.herokuapp.com",REACT_APP_TEST_ENV:"greatworld"})),r.a.createElement(x.c,{history:Ke},r.a.createElement("div",null,r.a.createElement(x.d,null,r.a.createElement(x.b,{exact:!0,path:"/"},r.a.createElement(x.a,{to:"/login"})),r.a.createElement(x.b,{exact:!0,path:"/login",component:U}),r.a.createElement(x.b,{exact:!0,path:"/register",component:W}),r.a.createElement(Ve,{exact:!0,path:"/main",component:Ne}),r.a.createElement(x.b,{exact:!0,path:"/admin",component:Be}))))}}]),a}(n.Component);var Ye=Object(o.b)((function(e){return{user:e.auth.user}}))(He);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(o.a,{store:h},r.a.createElement(Ye,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[147,1,2]]]);
//# sourceMappingURL=main.e8d22d23.chunk.js.map